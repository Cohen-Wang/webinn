<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <link rel="icon" href="../../../res/images/logo/logo_16x16.png" type="image/x-icon" />
        <link rel="shortcut icon" href="../../../res/images/logo/logo_16x16.png" type="image/x-icon"/>
        <title>heartShow</title>
        <style>
            *{margin:0;padding: 0}
            html{height:100%}
            body{height:100%;min-height:900px;overflow: hidden;}
        </style>
    </head>
    <body id="body">





        <script src="https://cdn.bootcss.com/stats.js/16/Stats.js"></script>
        <script>
            /*************************************
             * Author : Cohen_Wang
             * Date : 2018 - 11 - 11
             */

            (function (namespace) {

                let HeartShow = (function () {
                    // 构造
                    function HeartShow (param) {
                        // 传参
                        this.id = param.id;
                        this.probability = param.probability || 0.1;
                        this.minSize = param.minSize || 1;
                        this.maxSize = param.maxSize || 5;
                        this.minSpeed = param.minSpeed || 0.3;
                        this.maxSpeed = param.maxSpeed || 0.5;
                        this.minOpacity = param.minOpacity || 0.3;
                        this.maxOpacity = param.maxOpacity || 1;
                        this.minOpacitySpeed = param.minOpacitySpeed || .003;
                        this.maxOpacitySpeed = param.maxOpacitySpeed || .005;
                        this.canvasBackgoundColor = "#fff";
                        // 获取
                        this.can = document.createElement('canvas');
                        this.ctx = this.can.getContext('2d');

                        this.oContainer = document.getElementById(this.id);
                        this.oContainer.appendChild(this.can);

                        // 变量
                        this.startNum = 10;
                        this.num = 50;
                        this.elements = [];
                        let _this = this;
                        // 执行
                        this.init();
                        this.createElements(this.startNum);
                        //
                        this.timer = window.setInterval(function () {
                            _this.ctx.clearRect(0, 0, _this.can.width, _this.can.height);
                            _this.update();
                            _this.render();
                        }, 1000/60);
                    }

                    /**
                     * 初始化
                     */
                    HeartShow.prototype.init = function () {
                        this.can.width = this.can.parentNode.offsetWidth;
                        this.can.height = this.can.parentNode.offsetHeight;
                        this.can.style.backgroundColor = this.canvasBackgoundColor;
                    };

                    function _random (min, max) {
                        return Math.random() * (max - min) + min;
                    }
                    /**
                     * 创建爱心
                     */
                    HeartShow.prototype.createElements = function (num) {
                        for (let i = 0; i < num; i++) {
                            this.elements.push({
                                x : _random(0, this.can.width),
                                y : _random(0, this.can.height),
                                size : _random( this.minSize, this.maxSize),
                                sizeSpeed : _random(this.minSpeed, this.maxSpeed),
                                opacity : _random(this.minOpacity, this.maxOpacity),
                                opacitySpeed : _random(this.minOpacitySpeed, this.maxOpacitySpeed),
                                color : 'rgb('+~~_random(0,255)+','+~~_random(0,255)+','+~~_random(0,255)+')',
                            })
                        }
                    };

                    /**
                     * update
                     */
                    HeartShow.prototype.update = function () {
                        for (let i = 0; i < this.elements.length; i++) {
                            this.elements[i].opacity -= this.elements[i].opacitySpeed;
                            // if (this.elements[i].size >= 30) {
                            //     this.elements[i].sizeSpeed = 30;
                            // } else {
                            //     this.elements[i].size += this.elements[i].sizeSpeed;
                            // }
                            this.elements[i].size += this.elements[i].sizeSpeed;
                            //
                            if (this.elements[i].opacity <= 0) {
                                this.elements.splice(i, 1);
                            }
                        }
                        if (this.elements.length <= this.num && Math.random() > this.probability) {
                            this.createElements(1);
                        }
                    };

                    /**
                     * render
                     */
                    HeartShow.prototype.render = function () {
                        for (let i = 0; i < this.elements.length; i++) {
                            this.ctx.fillStyle = this.elements[i].color;// _this.color;
                            this.ctx.globalAlpha = this.elements[i].opacity;
                            this.ctx.beginPath();
                            // ❤❤❤❤
                            this.drawHeart(this.elements[i].x, this.elements[i].y, this.elements[i].size, this.elements[i].size);
                            this.ctx.closePath();
                            this.ctx.fill();
                            this.ctx.globalAlpha = 1;
                        }
                    };

                    /**
                     * 绘制爱心的方法
                     * @param x 初始坐标
                     * @param y 初始坐标
                     * @param z 大小
                     * @param m 爱心上升的速度
                     */
                    HeartShow.prototype.drawHeart = function (x, y, z, m) {
                        x += m;// 左飘
                        x -= m;// 右飘
                        y -= m * 20;// 上飘
                        //
                        this.ctx.moveTo(x, y);
                        z *= 0.05;
                        this.ctx.bezierCurveTo(x, y - 3*z, x - 5*z, y - 15*z, x - 25*z, y - 15*z);
                        this.ctx.bezierCurveTo(x - 55*z, y - 15*z, x - 55*z, y + 22.5*z, x - 55*z, y + 22.5*z);
                        this.ctx.bezierCurveTo(x - 55*z, y + 40*z, x - 35*z, y + 62*z, x, y + 80*z);
                        this.ctx.bezierCurveTo(x + 35*z, y + 62*z, x + 55*z, y + 40*z, x + 55*z, y + 22.5*z);
                        this.ctx.bezierCurveTo(x + 55*z, y + 22.5*z, x + 55*z, y - 15*z, x + 25*z, y - 15*z);
                        this.ctx.bezierCurveTo(x + 10*z, y - 15*z, x, y - 3*z, x, y);
                    };

                    return HeartShow;
                }) ();
                namespace.HeartShow = HeartShow;

            }) (window.cyber || (cyber = Object.create(null)));

        </script>



        <script>

            let a = new cyber.HeartShow({
                id : 'body',
            });

        </script>
    </body>
</html>