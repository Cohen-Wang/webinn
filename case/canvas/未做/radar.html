<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <link rel="icon" href="../../../res/images/logo/logo_16x16.png" type="image/x-icon" />
        <link rel="shortcut icon" href="../../../res/images/logo/logo_16x16.png" type="image/x-icon"/>
        <title>radar</title>
        <style>
            *{margin:0;padding: 0}
            html{height:100%}
            body{height:100%;min-height:900px;overflow: hidden;}
        </style>
    </head>
    <body id="body">





        <script src="https://cdn.bootcss.com/stats.js/16/Stats.js"></script>
        <script>
            /*************************************
             * Author : Cohen_Wang
             * Date : 2018 - 10 - 27
             */

            (function (namespace) {

                let __extend = function (_child, _super) {
                    for (let p in _super.prototype) {
                        if (_super.prototype.hasOwnProperty(p)) {
                            _child.prototype[p] = _super.prototype[p];
                        }
                    }
                };


                let Canvas = (function () {
                    // 构造
                    function Canvas (id) {
                        this.id = id;
                        this.createCanvas();
                    }
                    // 创建canvas
                    Canvas.prototype.createCanvas = function () {
                        this.oContainer = document.getElementById(this.id);

                        this.can = document.createElement('canvas');
                        this.ctx = this.can.getContext('2d');

                        this.can.width = this.oContainer.offsetWidth;
                        this.can.height = this.oContainer.offsetHeight;

                        this.oContainer.appendChild(this.can);
                    };
                    return Canvas;
                }) ();


                let Circle = (function () {
                    // 构造
                    function Circle (x, y, radius, color) {
                        this.x = x;
                        this.y = y;
                        this.radius = radius;// 半径
                        this.color = color;
                    }
                    // 绘画
                    Circle.prototype.drawCircle = function (ctx) {
                        ctx.save();
                        ctx.beginPath();
                        ctx.fillStyle = this.color;
                        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.closePath();
                        ctx.restore();
                    };
                    return Circle;
                }) ();


                let Radar = (function () {
                    // 构造
                    function Radar (id) {
                        Canvas.call(this, id);
                        //
                        this.num = 200;
                        this.centerX = this.can.width / 2;
                        this.centerY = this.can.height / 2;
                        this.beta = 0;
                        this.rectColor = 'rgba(255, 255, 255, 0.1)';
                        // 创建
                        this.circles = this.createCircle(this.num);
                        //
                        this.start();
                    }
                    // 继承
                    __extend(Radar, Canvas);
                    // 随机
                    function random (m, n) {
                        return Math.random() * (n - m) + m;
                    }
                    // 随机颜色
                    function randomColor () {
                        let r = ~~random(0, 255);
                        let g = ~~random(0, 255);
                        let b = ~~random(0, 255);
                        return 'rgb(' + r + ',' + g + ',' + b + ')';
                    }
                    // 创建水草
                    Radar.prototype.createCircle = function (num) {
                        let circles = [];
                        for (let i = 0; i < num; i++) {
                            // 创建数据

                            /**
                             * 这里创建 圆 的属性，需要围绕到中心圆来画，所以需要做特殊处理
                             * 错误做法
                             */
                            // let x = random(50, 100);
                            // let y = random(50, 100);
                            /**
                             * 正确做法
                             */
                            let distance = random(50, 300);// 随机设定一个，到圆心的距离
                            let randomAngle = random(0, 360);// 随机点与中心点的弧度

                            let x = this.centerX + distance * Math.cos(randomAngle * Math.PI /180);
                            let y = this.centerY + distance * Math.sin(randomAngle * Math.PI /180);

                            let radius = random(3, 5);
                            let color = randomColor();
                            // 生成
                            circles.push(new Circle(x, y, radius, color));
                        }
                        return circles;
                    };

                    function getDistanceBetweenTwoPoints (startPoint, endPoint, precision = 2) {
                        let distance;
                        let distance_x = endPoint.x - startPoint.x;
                        let distance_y = endPoint.y - startPoint.y;
                        distance = Math.sqrt( Math.pow(distance_x, 2) + Math.pow(distance_y, 2) ).toFixed(precision);/*两点之间距离公式：Math.sqrt( x² + y²)*/
                        return +distance;/*+ : 加号作用：字符串转数字*/
                    }
                    // 更新
                    Radar.prototype.update = function () {
                        this.beta++;
                        for (let i = 0; i < this.circles.length; i++) {
                            let startPoint = {x : this.circles[i].x, y : this.circles[i].y};
                            let endPoint = {x : this.centerX, y : this.centerY};
                            let distance = getDistanceBetweenTwoPoints(startPoint, endPoint);

                            this.circles[i].x = this.centerX + distance * Math.cos((this.beta + distance) * Math.PI /180);
                            this.circles[i].y = this.centerY + distance * Math.sin((this.beta + distance) * Math.PI /180);
                        }
                    };
                    // 渲染
                    Radar.prototype.render = function () {
                        for (let i = 0; i < this.circles.length; i++) {
                            // 画圆
                            this.circles[i].drawCircle(this.ctx);
                            // 画中心点
                            new Circle(this.centerX, this.centerY, 10, 'red').drawCircle(this.ctx);
                            // 画直线
                            this.drawLine(this.circles[i].x, this.circles[i].y, this.centerX, this.centerY);
                            // 模糊
                            this.drawRect();
                        }
                    };
                    // 开始动
                    Radar.prototype.start = function () {
                        let _this = this;
                        go();
                        function go () {
                            window.requestAnimationFrame(go);
                            // 清空
                            //_this.ctx.clearRect(0, 0, _this.can.width, _this.can.height);
                            //
                            _this.update();
                            _this.render();
                        }
                    };
                    // 画线
                    Radar.prototype.drawLine = function (startX, startY, endX, endY, color) {
                        color = color || '#000';
                        this.ctx.save();
                        this.ctx.beginPath();
                        this.ctx.strokeStyle = color;
                        this.ctx.lineWidth = 0.05;
                        this.ctx.moveTo(startX, startY);
                        this.ctx.lineTo(endX, endY);
                        this.ctx.stroke();
                        this.ctx.closePath();
                        this.ctx.restore();
                    };
                    // 画方形
                    Radar.prototype.drawRect = function () {
                        this.ctx.save();
                        this.ctx.beginPath();
                        this.ctx.fillStyle = this.rectColor;
                        this.ctx.rect(0, 0, this.can.width, this.can.height);
                        this.ctx.fill();
                        this.ctx.closePath();
                        this.ctx.restore();
                    };
                    return Radar;
                }) ();
                namespace.Radar = Radar;

            }) (window.cyber || (cyber = Object.create(null)));

        </script>



        <script>

            let a = new cyber.Radar('body');

        </script>
    </body>
</html>